<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Pruebas con Django+DRF+Pytest</title>
<meta name="author" content="(Jonathan Sandoval)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js-3.9.2/css/reveal.css"/>

<link rel="stylesheet" href="./reveal.js-3.9.2/css/theme/black.css" id="theme"/>

<link rel="stylesheet" href="./custom.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '/home/ark/src/reveal.js-3.9.2/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity=""><h1 class="title">Pruebas con Django+DRF+Pytest</h1>
</section>

<section>
<section id="slide-org0f9fe90" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h2 id="org0f9fe90"><span class="section-number-2">1</span> El caso a favor de automatizar las pruebas</h2>
<div class="outline-text-2" id="text-1">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org65b3339" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org65b3339"><span class="section-number-3">1.1</span> Un ejemplo (¿dónde está el error?)</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">from</span> collections <span style="color: #F0DFAF; font-weight: bold;">import</span> defaultdict


<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">WordCount</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>._count = defaultdict(<span style="color: #DCDCCC; font-weight: bold;">int</span>)

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">add</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, word: <span style="color: #DCDCCC; font-weight: bold;">str</span>):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>._count[word.lower()] += 1

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">count</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, word: <span style="color: #DCDCCC; font-weight: bold;">str</span>) -&gt; <span style="color: #DCDCCC; font-weight: bold;">int</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>._count[word]
</code></pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-orgcf52ce3" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgcf52ce3"><span class="section-number-3">1.2</span> Corrección</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">from</span> collections <span style="color: #F0DFAF; font-weight: bold;">import</span> defaultdict


<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">WordCount</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>._count = defaultdict(<span style="color: #DCDCCC; font-weight: bold;">int</span>)

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">add</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, word: <span style="color: #DCDCCC; font-weight: bold;">str</span>):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>._count[word.lower()] += 1

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">count</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, word: <span style="color: #DCDCCC; font-weight: bold;">str</span>) -&gt; <span style="color: #DCDCCC; font-weight: bold;">int</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>._count[word.lower()]
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org9705cf8" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org9705cf8"><span class="section-number-3">1.3</span> Pensemos&#x2026;</h3>
<ul>
<li>¿Realmente corregimos el error?</li>
<li><p>
Podemos probar manualmente
</p>

<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">from</span> fixme <span style="color: #F0DFAF; font-weight: bold;">import</span> WordCount

<span style="color: #DFAF8F;">wc</span> = WordCount()
wc.add(<span style="color: #CC9393;">"ALL"</span>)
wc.add(<span style="color: #CC9393;">"All"</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Hay un error en este test.</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(wc.count(<span style="color: #CC9393;">"All"</span>) == wc.count(<span style="color: #CC9393;">"ALL"</span>))
</code></pre>
</div></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org9efd5a5" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org9efd5a5"><span class="section-number-3">1.4</span> Problemas</h3>
<ul>
<li>¿Y si alguien reintroduce el error?</li>
<li>Es mejor tener un test automático.</li>
<li>El test se ejecuta después de cada cambio.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgdba1b0b" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgdba1b0b"><span class="section-number-3">1.5</span> El test</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">from</span> fixed <span style="color: #F0DFAF; font-weight: bold;">import</span> WordCount

<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">test_count_case</span>():
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">wc</span> = WordCount()
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   wc.add(<span style="color: #CC9393;">"ALL"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   wc.add(<span style="color: #CC9393;">"All"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">assert</span> wc.count(<span style="color: #CC9393;">"All"</span>) == wc.count(<span style="color: #CC9393;">"ALL"</span>)
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh"><code trim>pytest test_fixed.py
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org5cd0ba8" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org5cd0ba8"><span class="section-number-3">1.6</span> Más problemas</h3>
<ul>
<li>¿Cómo sabemos si el test es correcto?</li>
<li><p>
Si lo ejecutamos contra código erróneo, debe fallar.
</p>

<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">from</span> fixme <span style="color: #F0DFAF; font-weight: bold;">import</span> WordCount

<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">test_count_case</span>():
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">wc</span> = WordCount()
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   wc.add(<span style="color: #CC9393;">"ALL"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   wc.add(<span style="color: #CC9393;">"All"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">assert</span> wc.count(<span style="color: #CC9393;">"All"</span>) == wc.count(<span style="color: #CC9393;">"ALL"</span>)
</code></pre>
</div></li>

<li>Spoiler: ¡No falla!</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgdaf4644" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgdaf4644"><span class="section-number-3">1.7</span> Análisis</h3>
<ul>
<li>¿Está mal el test?</li>
<li>¿Está mal el código?</li>
<li>¿Ambos?</li>
<li>Hay que documentar la <b>intención</b> del test.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org9a95598" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org9a95598"><span class="section-number-3">1.8</span> El test v2.0</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">from</span> fixed <span style="color: #F0DFAF; font-weight: bold;">import</span> WordCount


<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">test_count_case</span>():
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #9FC59F;">"""WordCount.count() retorna el conteo correcto para una palabra sin</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #9FC59F;">   importar may&#250;sculas.</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #9FC59F;">   """</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">wc</span> = WordCount()
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   wc.add(<span style="color: #CC9393;">"All"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   wc.add(<span style="color: #CC9393;">"ALL"</span>)

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">assert</span> (wc.count(<span style="color: #CC9393;">"All"</span>), wc.count(<span style="color: #CC9393;">"ALL"</span>)) == (2, 2)
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org45204df" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org45204df"><span class="section-number-3">1.9</span> Conclusiones del caso (a favor de la automatización)</h3>
<ul>
<li>¿Daño funcionalidad con nuevos cambios o correcciones?
<ul>
<li>Una buena <b>cobertura</b> lo soluciona.</li>

</ul></li>
<li>¿Es tedioso e imposible ejecutar pruebas manuales de todo?
<ul>
<li>Pruebas automáticas.</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgb5ad243" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgb5ad243"><span class="section-number-3">1.10</span> El proceso</h3>
<ol>
<li>Probamos el código a corregir.</li>
<li>Agregamos pruebas automáticas que se ejecutan repetidamente.</li>
<li>Las pruebas que fallaban deben <i>pasar</i>.</li>
<li>Toda prueba debe tener documentar su <i>intención</i>.</li>
<li>Probar (casi) <b>todo</b> el código.</li>

</ol>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgac61b64" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h2 id="orgac61b64"><span class="section-number-2">2</span> El caso a favor de TDD (Test Driven Development)</h2>
<div class="outline-text-2" id="text-2">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org9a42949" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org9a42949"><span class="section-number-3">2.1</span> TDD</h3>
<p>
Desarrollo guiado por pruebas (Test Driven Development)
</p>
<div class="slide-footer"></div>
</section>
<section id="slide-org81d4c6e" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org81d4c6e"><span class="section-number-3">2.2</span> El proceso con TDD</h3>
<ul>
<li>Todo software tiene requerimientos.</li>
<li>Los requerimientos de <b>codifican</b> en tests automáticos que fallan
inicialmente.
<ul>
<li>Los tests son la <b>especificación</b> del programa.</li>

</ul></li>
<li>El código cumple la especificación.</li>
<li>El código está listo cuando pasa los tests.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgcbbd116" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgcbbd116"><span class="section-number-3">2.3</span> El proceso con TDD</h3>
<ol>
<li>Escribimos un test.
<ul>
<li>El comentario indica parte del requerimiento.</li>
<li>El código <b>debe</b> falla porque no hay nada implementado.</li>

</ul></li>
<li>Escribimos el código suficiente para que el test pase.
<ul>
<li>Es decir, cumplimos con la especificación codificada en el
test.</li>

</ul></li>
<li>Ejecutamos el test. Si pasa, repetimos el ciclo.</li>
<li>De manera opcional, podemos refactorizar el código recién.
<ul>
<li>El refactoring se realiza tanto al código como a los tests.</li>

</ul></li>

</ol>

<div class="slide-footer"></div>
</section>
<section id="slide-org740feb4" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org740feb4"><span class="section-number-3">2.4</span> Correcciones con TDD (bugs)</h3>
<ol>
<li>Escribir primero el test que replique el error.</li>
<li>Cadena de documentación.</li>
<li>Asegurarse que el test falla.</li>
<li>Arreglar el código.</li>
<li>Ejecutar el test, asegurarse que pasa.</li>

</ol>
<div class="slide-footer"></div>
</section>
<section id="slide-orgdd42b38" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgdd42b38"><span class="section-number-3">2.5</span> Nuevas características</h3>
<ul>
<li>Posible diseño exploratorio.</li>
<li>Descripción detallada de requerimientos.</li>
<li>Para cada requerimiento.
<ul>
<li>Escribir un test que falla.</li>
<li>Escribir código que pasa el test.</li>
<li>Siguiente test para requerimiento.</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org906aff4" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org906aff4"><span class="section-number-3">2.6</span> ¿Qué probar?</h3>
<ul>
<li>¡La <code>API</code> pública!
<ul>
<li>La <code>api</code> debe ser tan pequeña como sea posible.</li>

</ul></li>
<li>En nuestro ejemplo, <code>_count</code> no se prueba, es un detalle interno
de la implementación.</li>
<li>Casos extremos.</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org79cfb5d" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h2 id="org79cfb5d"><span class="section-number-2">3</span> Más de tests (nuevamente, el caso a favor de los tests)</h2>
<div class="outline-text-2" id="text-3">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org82f4a22" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org82f4a22"><span class="section-number-3">3.1</span> ¿Quién hace los tests?</h3>
<ul>
<li>Los usuarios finales <b>deben</b> ser la última linea de testeo.</li>
<li>Sin tests suficientes (manuales, automáticas, end to end, de
integración, unitarios, etc.) más <code>bugs</code> serán descubiertos en
producción.
<ul>
<li>Pérdida de usuarios (usuarios enojados).</li>
<li>Daños en la información.</li>
<li>Pérdida de confianza.</li>
<li>Más soporte.</li>
<li>Dificultad para liberar correcciones.</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orge99b66d" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orge99b66d"><span class="section-number-3">3.2</span> Manual vs. automático</h3>
<ul>
<li>Automatizar es más barato.
<ul>
<li>Los tests pueden ejecutarse tantas veces como se quiera sin
costo alguno.</li>
<li>Integración Continua (CI)</li>

</ul></li>
<li>Manuales
<ul>
<li>Tests más realistas.</li>
<li>Hay errores que solo pueden encontrarse con pruebas manuales.</li>
<li>Hay tipos de pruebas que no vale la pena automatizar.</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org9d75d69" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org9d75d69"><span class="section-number-3">3.3</span> ¿Cuándo hacer pruebas, qué tipo de pruebas?</h3>

<div class="figure">
<p><img src="./big_picture.png" alt="big_picture.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orga687af9" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orga687af9"><span class="section-number-3">3.4</span> Refactoring</h3>
<ul>
<li>Si tenemos tests, el refactoring es posible y muy fácil.</li>
<li>Podemos cambiar cantidades masivas de código casi sin
preocupaciones.</li>
<li>En mi experiencia, rara vez ejecuto el servicio antes de subir el
código. (nada de <code>python manage.py runserver</code>).
<ul>
<li>Menos tiempo de desarrollo.</li>

</ul></li>
<li>Reducción de la <i>deuda técnica</i>.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org617d821" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org617d821"><span class="section-number-3">3.5</span> Código antiguo (Legacy code)</h3>
<ul>
<li>Legacy code -&gt; código sin tests.</li>
<li>Los tests se hacen sobre la marcha.
<ul>
<li>Cambio sobre código existente implica agregar tests primero.</li>
<li>Toda nueva característica debe venir con sus respectivos tests.</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgc7c7d24" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h2 id="orgc7c7d24"><span class="section-number-2">4</span> Manos a la obra</h2>
<div class="outline-text-2" id="text-4">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org7da979e" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org7da979e"><span class="section-number-3">4.1</span> El «proyecto»</h3>
<p>
Implementar una <code>API</code> para una aplicación de tareas (todos)
</p>
<div class="slide-footer"></div>
</section>
<section id="slide-org94421be" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org94421be"><span class="section-number-3">4.2</span> El «proyecto» (II)</h3>
<ul>
<li>App de tareas multiusuario.</li>
<li>Solo los usuarios autenticados pueden interactuar con la API.</li>
<li>Las tareas incluyen:
<ul>
<li>Fecha de creación.</li>
<li>Hecha: sí/no.</li>
<li>Descripción.</li>

</ul></li>
<li>Un usuario puede crear una tarea.</li>
<li>Un usuario puede listar todas sus tareas.</li>
<li>Un usuario puede eliminar una tarea.</li>
<li>Un usuario puede marcar una tarea como hecha.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgedb3ce6" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgedb3ce6"><span class="section-number-3">4.3</span> El «proyecto» (III)</h3>
<ul>
<li>Un usuario puede ver el detalle de una tarea.</li>
<li>Las tareas se listan ordenadas por fecha de creación.</li>
<li>No se puede alterar la fecha de creación.</li>
<li>Un usuario no puede listar las tareas de otro usuario.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org1c5f75f" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org1c5f75f"><span class="section-number-3">4.4</span> ¿Qué vamos a usar?</h3>
<dl>
<dt><code>Python</code></dt><dd>en su versión 3.8.</dd>
<dt><code>Django</code></dt><dd>El framework web en su versión 3.</dd>
<dt><code>DRF</code></dt><dd>El framework para implementar una <code>REST</code>.</dd>
<dt><code>pytest</code></dt><dd>El verdadero framework <code>pitónico</code> para tests.</dd>

</dl>
<div class="slide-footer"></div>
</section>
<section id="slide-orge59c099" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orge59c099"><span class="section-number-3">4.5</span> ¿Qué vamos a usar? (II)</h3>
<dl>
<dt><code>pytest-django</code></dt><dd>Extensión de <code>pytest</code> para funcionar mejor con
<code>django</code>.</dd>
<dt>djangorestframework-simplejwt</dt><dd>JSON Web Tokens.</dd>
<dt>model<sub>bakery</sub></dt><dd>Llenando la base de datos para pruebas.</dd>
<dt>httpie</dt><dd>Para hacer pruebas manuales de la api.</dd>

</dl>
<div class="slide-footer"></div>
</section>
<section id="slide-org0279521" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org0279521"><span class="section-number-3">4.6</span> El entorno virtual</h3>
<div class="org-src-container">

<pre  class="src src-sh"><code trim>python -m venv venv
<span style="color: #DCDCCC; font-weight: bold;">source</span> venv/bin/activate
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orga032740" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orga032740"><span class="section-number-3">4.7</span> Django y el DRF</h3>
<div class="org-src-container">

<pre  class="src src-sh"><code trim>pip install django
pip install djangorestframework
pip install pytest
pip install pytest-django

django-admin startproject talk
<span style="color: #DCDCCC; font-weight: bold;">cd</span> talk
django-admin startapp tasks

python manage.py migrate
python manage.py createsuperuser --email admin@example.com --username admin
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org683fe69" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org683fe69"><span class="section-number-3">4.8</span> Settings</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #DFAF8F;">INSTALLED_APPS</span> = [
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   ...
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">'rest_framework'</span>,
]

<span style="color: #DFAF8F;">REST_FRAMEWORK</span> = {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">'DEFAULT_PAGINATION_CLASS'</span>: <span style="color: #CC9393;">'rest_framework.pagination.PageNumberPagination'</span><span style="color: #DC8CC3; background-color: #3F3F3F;">,</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">'PAGE_SIZE'</span>: 10
}
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orge253d3e" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orge253d3e"><span class="section-number-3">4.9</span> Crear tareas</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">tasks/tests.py</span>
<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">test_create_task</span>():
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #9FC59F;">"""Authenticated user can create tasks.</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #9FC59F;">   A 201 is expected.</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #9FC59F;">   """</span>
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org115ebd7" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org115ebd7"><span class="section-number-3">4.10</span> Necesitamos&#x2026;</h3>
<ul>
<li>Realizar un <code>POST</code> a una url:
<ul>
<li><code>api/v1/tasks</code></li>
<li><code>api/v1/tasks/create</code> (no muy <code>RESTful</code>).</li>

</ul></li>
<li>Un <i>cliente</i> para hacer la petición.</li>
<li>Un <i>servidor</i> al cual hacerle la petición.
<ul>
<li>Lo incluye <code>pytest-django</code>.</li>

</ul></li>
<li>Un <code>usuario autenticado</code>.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org9f8121f" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org9f8121f"><span class="section-number-3">4.11</span> Segunda versión</h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">import</span> json
<span style="color: #F0DFAF; font-weight: bold;">from</span> django.urls <span style="color: #F0DFAF; font-weight: bold;">import</span> reverse
<span style="color: #F0DFAF; font-weight: bold;">from</span> rest_framework <span style="color: #F0DFAF; font-weight: bold;">import</span> status  <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Constantes</span>


<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">test_create_task_201_created</span>(client):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #9FC59F;">"""Authenticated user can create tasks.</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #9FC59F;">   A 201 is expected.</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #9FC59F;">   """</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">response</span> = client.post(
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   url=reverse(<span style="color: #CC9393;">"create-task"</span>),
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   data=json.dumps({<span style="color: #CC9393;">"description"</span>: <span style="color: #CC9393;">"Do this talk slides"</span>}),
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   content_type=<span style="color: #CC9393;">"application/json"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   )

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">assert</span> response.status_code == status.HTTP_201_CREATED
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orgefec64c" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgefec64c"><span class="section-number-3">4.12</span> Pytest settings</h3>
<div class="org-src-container">

<pre  class="src src-conf"><code trim>[<span style="color: #7CB8BB;">pytest</span>]
<span style="color: #DFAF8F;">DJANGO_SETTINGS_MODULE</span> = talk.test_settings
<span style="color: #DFAF8F;">python_files</span> = tests* test_* __init__.py
<span style="color: #DFAF8F;">addopts</span> = --reuse-db -p no:warnings

</code></pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org987bab7" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org987bab7"><span class="section-number-3">4.13</span> test<sub>settings</sub></h3>
<div class="org-src-container">

<pre  class="src src-python"><code trim><span style="color: #F0DFAF; font-weight: bold;">import</span> logging
<span style="color: #F0DFAF; font-weight: bold;">from</span> .settings <span style="color: #F0DFAF; font-weight: bold;">import</span> *  <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">NOQA</span>
logging.disable(logging.CRITICAL)
<span style="color: #DFAF8F;">DATABASES</span> = {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">'default'</span>: {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">'ENGINE'</span>: <span style="color: #CC9393;">'django.db.backends.sqlite3'</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">'NAME'</span>: os.path.join(BASE_DIR, <span style="color: #CC9393;">'db_test.sqlite3'</span>),
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   }
}
<span style="color: #DFAF8F;">EMAIL_BACKEND</span> = <span style="color: #CC9393;">"django.core.mail.backends.locmem.EmailBackend"</span>
<span style="color: #DFAF8F;">DEBUG</span> = <span style="color: #BFEBBF;">False</span>
<span style="color: #DFAF8F;">TEMPLATE_DEBUG</span> = <span style="color: #BFEBBF;">False</span>
<span style="color: #DFAF8F;">PASSWORD_HASHERS</span> = [<span style="color: #CC9393;">"django.contrib.auth.hashers.MD5PasswordHasher"</span>]
<span style="color: #DFAF8F;">MIDDLEWARE</span> = [
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"django.contrib.sessions.middleware.SessionMiddleware"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"django.middleware.csrf.CsrfViewMiddleware"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"django.contrib.auth.middleware.AuthenticationMiddleware"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"django.contrib.messages.middleware.MessageMiddleware"</span>,
]
<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">DisableMigrations</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__contains__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, item):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">True</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__getitem__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, item):
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">None</span>


<span style="color: #DFAF8F;">MIGRATION_MODULES</span> = DisableMigrations()
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org7418307" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="org7418307"><span class="section-number-3">4.14</span> Fixtures</h3>
<ul>
<li>Código común a todos los tests.</li>
<li>Explícitos, reutilizables.</li>
<li>Se usan a través de inyección de dependencias.</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org012a54f" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h2 id="org012a54f"><span class="section-number-2">5</span> Otros ideas</h2>
<div class="outline-text-2" id="text-5">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orgea6432a" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgea6432a"><span class="section-number-3">5.1</span> Creando una aplicación escalable</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org9f4efa5" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="org9f4efa5"><span class="section-number-4">5.1.1</span> ¿Dónde ubicar la lógica?</h4>
<div class="slide-footer"></div>
</section>
<section id="slide-org1e6cf4e" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="org1e6cf4e"><span class="section-number-4">5.1.2</span> ¿Django es MVC?</h4>
<ul>
<li>Plantillas (Templates)</li>
<li>Vistas (Views)</li>
<li>Modelos (Models)</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org9480de0" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="org9480de0"><span class="section-number-4">5.1.3</span> ¿MVC?</h4>
<ul>
<li>Templates -&gt; Vistas</li>
<li>Vistas -&gt; Controladores</li>
<li>Modelos -&gt; Modelos</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org4d3f9af" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="org4d3f9af"><span class="section-number-4">5.1.4</span> ¡NO!</h4>
<ul>
<li>Modelos -&gt; Modelos</li>
<li>Vistas -&gt; Plantillas + vistas (+ serializadores)</li>
<li>Controladores -&gt; ??</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgf18fbb5" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="orgf18fbb5"><span class="section-number-4">5.1.5</span> Capas, capas, capas</h4>
<ul>
<li>Capas:
<dl>
<dt>Presentación</dt><dd>Vistas + plantillas + serializadores. Se
encargan de la presentación de la información.</dd>
<dt>Infraestructura</dt><dd>Incluye los modelos, envíos de correo,
tareas asíncronas (celery), etc.</dd>
<dt>Servicios</dt><dd>Representan acciones sobre la
información.</dd>

</dl></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org3aa6848" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="org3aa6848"><span class="section-number-4">5.1.6</span> Servicios</h4>
<ul>
<li><code>services.py</code></li>
<li><code>selectors.py</code></li>
<li>También podría llamarse <code>api.py</code> y mezclar paquetes y
selectores.</li>
<li>Si creen demasiado se transforman en paquetes.</li>
<li>Internamente puede tener funciones auxiliares, clases, etc.
<ul>
<li>No importa, lo importante que las vistas se limiten a los
servicios/selectores que correspondan a la <code>api</code> de esta capa.</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orge867d4a" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="orge867d4a"><span class="section-number-4">5.1.7</span> Estructura</h4>
<ul>
<li><code>/project/</code>
<ul>
<li><code>/config/</code>
<ul>
<li><code>/settings/</code></li>

</ul></li>
<li><code>/app1/</code>
<ul>
<li><code>/models.py</code></li>
<li><code>/views.py</code></li>
<li><code>/selectors.py</code></li>
<li><code>/services.py</code></li>
<li>(No, no hay <code>serializers.py</code>)</li>
<li><code>/tests/</code>
<ul>
<li><code>/views/</code> (pruebas de vistas)</li>
<li><code>/services/</code> (pruebas de servicios)</li>
<li><code>/selectors/</code> (pruebas de selectores)</li>

</ul></li>

</ul></li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org801a86d" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h4 id="org801a86d"><span class="section-number-4">5.1.8</span> Vistas y modelos</h4>
<dl>
<dt>Modelos</dt><dd>Se limitan a contener campos y a validaciones
simples. No incluyen consultas complejas (que impliquen datos
más allá de los propios).</dd>
<dt>Vistas</dt><dd>Las vistas llaman servicios y selectores. Se encargan
de paginar, de entregar la representación que el cliente
solicita (<code>Content-Type</code>). Incluyen los <code>serializers</code>.</dd>

</dl>
<div class="slide-footer"></div>
</section>
<section id="slide-orgf55a4d9" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgf55a4d9"><span class="section-number-3">5.2</span> model<sub>bakery</sub></h3>
<ul>
<li>Creación automática de objetos de la base de datos.</li>
<li>Llena automáticamente los campos con valores por defecto,
relaciones obligatorias, etc.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgc6fd81c" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orgc6fd81c"><span class="section-number-3">5.3</span> mocks</h3>
<ul>
<li><code>pytest-mocker</code>
<ul>
<li>Si usan <code>services</code>, los <code>tests</code> de las vistas pueden tener
<code>mocks</code> de los servicios que llaman.</li>

</ul></li>
<li>Sirven para aislar consultas a servicios de terceros.</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orga1b2214" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h3 id="orga1b2214"><span class="section-number-3">5.4</span> Herramientas</h3>
<ul>
<li>Flake8.</li>
<li>Black.</li>
<li>Integración continua.</li>
<li><code>Type hinting</code></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgadbfffc" data-background="" data-background-size="" data-background-position="" data-background-repeat="" data-background-transition="" data-background-opacity="">
<div class="slide-header"></div>
<h2 id="orgadbfffc"><span class="section-number-2">6</span> ¿Preguntas?</h2>
<div class="slide-footer"></div>
</section>
</section>
</div>
</div>
<script src="/home/ark/src/reveal.js-3.9.2/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
,
 { src: '/home/ark/src/reveal.js-3.9.2/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: '/home/ark/src/reveal.js-3.9.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: '/home/ark/src/reveal.js-3.9.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: '/home/ark/src/reveal.js-3.9.2/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: '/home/ark/src/reveal.js-3.9.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
,});
</script>
</body>
</html>
